<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WC Order Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f7f7;
    }
    .upload-section {
      max-width: 1200px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .upload-section h2 {
      font-size: 18px;
      margin-bottom: 10px;
    }
    .container {
      display: flex;
      max-width: 1200px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .main-content {
      flex: 2;
      padding-right: 20px;
    }
    .sidebar {
      flex: 1;
      background: #fff;
      padding: 20px;
      border-left: 1px solid #ddd;
    }
    .section {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      background: #fff;
      border-radius: 5px;
    }
    h2 {
      font-size: 18px;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    .order-actions {
      margin-top: 10px;
    }
    .btn {
      display: inline-block;
      padding: 10px 15px;
      margin: 5px;
      background: #0073aa;
      color: white;
      text-decoration: none;
      border-radius: 5px;
    }
    .btn-danger {
      background: #d63638;
    }
  </style>
</head>
<body>
  <!-- Avsnitt för att ladda upp JSON-fil -->
  <div class="upload-section">
    <h2>Ladda upp JSON-fil</h2>
    <input type="file" id="jsonFileInput" accept=".json">
  </div>

  <!-- Här renderas ordern -->
  <div id="orderContainer"></div>

  <script>
    // När en fil väljs läses innehållet in
    document.getElementById('jsonFileInput').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          // Anta att det finns minst en order och välj den första
          const orderKeys = Object.keys(data.orders);
          if (orderKeys.length === 0) {
            alert("Ingen order hittades i JSON‑filen.");
            return;
          }
          const orderId = orderKeys[0];
          const order = data.orders[orderId].wc_order;
          displayOrder(order);
        } catch (error) {
          console.error("Fel vid tolkning av JSON:", error);
          alert("Kunde inte läsa in JSON‑filen. Kontrollera att filen har rätt format.");
        }
      };
      reader.readAsText(file);
    });

    // Funktion som renderar orderdetaljer med samma layout som i din ursprungliga fil
    function displayOrder(order) {
      const orderLines = Object.values(order.line_items).map(line => `
        <tr>
            <td>${line.name}</td>
            <td>${line.subtotal}</td>
            <td>${line.quantity}</td>
            <td>${line.total}</td>
            <td>${line.total_tax}</td>
        </tr>
      `).join('');

      const couponLines = Object.values(order.coupon_lines).map(coupon => `
        <tr>
          <td>${coupon.id}</td>
          <td>${coupon.code}</td>
          <td>${coupon.discount}</td>
          <td>${coupon.discount_tax}</td>
          <td>
            <ul>
              ${coupon.meta_data.map(meta => `<li>${meta.key}: ${meta.value}</li>`).join('')}
            </ul>
          </td>
        </tr>
      `).join('');

      const metaData = order.meta_data.map(d => `
        <tr>
          <td>${d.key}</td>
          <td>${d.value}</td>
        </tr>
      `).join('');

      const orderNotes = Object.values(order.order_comments).map(note => `
        <div class="section">
          <p>${note.content}</p>
          <p>Added by: ${note.added_by}</p>
          <p>${note.date_created.date}</p>
          ${note.customer_note ? '<p>Customer Note</p>' : ''}
        </div>
      `).join('');

      const templateString = `
        <div class="container">
          <div class="main-content">
            <div class="section">
              <h2>Order #${order.id} ${order.number}</h2>
              <p><strong>Betalning via ${order.payment_method}. Transaction ID:</strong> ${order.transaction_id}</p>
              <p><strong>Date paid:</strong> ${order.date_paid.date}</p>
              <p><strong>Status:</strong> ${order.status}</p>
            </div>
            <div class="section">
              <h2>Billing</h2>
              <p><strong>Company:</strong> ${order.billing.company}</p>
              <p><strong>Namn:</strong> ${order.billing.first_name} ${order.billing.last_name}</p>
              <p><strong>Adress:</strong> ${order.billing.address_1} ${order.billing.address_2}, ${order.billing.postcode} ${order.billing.city}</p>
              <p><strong>Email:</strong> ${order.billing.email}</p>
              <p><strong>Telefon:</strong> ${order.billing.phone}</p>
            </div>
            <div class="section">
              <h2>Shipping</h2>
              <p><strong>Namn:</strong> ${order.shipping.first_name} ${order.shipping.last_name}</p>
              <p><strong>Adress:</strong> ${order.shipping.address_1} ${order.shipping.address_2}, ${order.shipping.postcode} ${order.shipping.city}</p>
              <p><strong>Telefon:</strong> ${order.shipping.phone}</p>
            </div>
            <div class="section">
              <h2>Orderdetaljer</h2>
              <table>
                <tr>
                    <th>Namn</th>
                    <th>Kostnad</th>
                    <th>Antal</th>
                    <th>Total</th>
                    <th>VAT</th>
                </tr>
                ${orderLines}
              </table>
              <table border="1">
                <thead>
                  <tr>
                    <th>Kupong ID</th>
                    <th>Kod</th>
                    <th>Rabatt</th>
                    <th>Rabatt Skatt</th>
                    <th>Meta Data</th>
                  </tr>
                </thead>
                <tbody>
                  ${couponLines}
                </tbody>
              </table>
              <p><strong>Frakt:</strong> ${order.shipping_total} kr</p>
              <p><strong>Moms:</strong> ${order.total_tax}</p>
              <p><strong>Totalt:</strong> ${order.total}</p>
            </div>
          </div>
          <div class="sidebar">
            <h2>Ordernoteringar</h2>
            ${orderNotes}
          </div>
        </div>
        <div class="section">
          <h2>Custom Fields</h2>
          <table>
            <tr>
              <th>Key</th>
              <th>Value</th>
            </tr>
            ${metaData}
          </table>
        </div>
      `;
      document.getElementById('orderContainer').innerHTML = templateString;
    }
  </script>
</body>
</html>
